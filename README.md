# Платформа

## База данных

### Описание

### Архитектура

* В основе архитектуры лежат подходы применяемые в объектно-ориентированном программировании (классы, методы, наследование).

Данные в системе представлены в виде объектов и имеют слой абстракции описание которого изложено ниже.

#### Слой абстракции

* Единицей хранения данных в системе является не запись в таблице, а **объект**. Понитие «таблица» заменено на сущность.

* Объекты в системе классифицируются т.е. распределены по классам в рамках заданной сущности.

#### Определение объекта

* **_Объект_** - это физическая или логическая сущность, которую можно представить в виде единого целого. Клиент, сотрудник, договор, счёт, заказ, услуга, транзакция все это отдельные сущности данные по которым в системе можно хранить в виде объекта.


* _Объект_ обладает рядом характеристик, таких как: «**_класс_**», «**_тип_**» и «**_состояние_**».


* Объект разделён на два базовых класса - **_документ_** и **_справочник_**.


* Класс _документ_ имеет свойство (поле) `area` (зона), которое, ограничивает «область видимости документа». Класс _справочник_ не обладает таким свойством.


* Над _объектом_ можно совершать «_действия_», которые вызывают в системе «_события_», которые, в свою очередь, могут привести к изменению «_состояния_» объекта. Всё это является частью **_документооборота_** системы.


* Объект наследует все свойства и методы классов родителей.

#### Документооборот

* Это последовательность совершаемых над объектом действий, приводящих к возникновению события (каскада событий), способных повлиять на состояние объекта.


* Последовательность переходов из одного состояния объекта в другое называется «жизненным циклом».

#### Сущность

* Характеризует физический или логический смысл _объекта_.

**Сущность** задаётся разработчиком системы и в отличие от других характеристик объекта не может быть изменена пользователем системы. 

На данный момент в системе определены следующие сущности:

- `object` Объект;
- `document` Документ;
- `reference` Справочник;
- `address` Адрес;
- `client` Клиент;
- `device` Устройство;
- `job` Задание;
- `message` Сообщение;
- `agent` Агент;
- `calendar` Календарь;
- `model` Модель;
- `program` Программа;
- `scheduler` Планировщик;
- `vendor` Производитель;
- `version` Версия;

#### Класс

* Это условное разделение объекта по тем или иным признакам в рамках заданной сущности.


* Класс объекта характеризует сам объект и в отличие от сущности может быть создан пользователем системы самостоятельно.


* Классы объекта создаются в виде дерева, т.е. имеют иерархическую структуру. Для каждого класса объекта настраиваются своя собственная схема документооборота, т.е. формируется список, в каких именно состояниях может находиться объект. Для каждого состояния создается список доступных действий, для каждого действия создается список событий и настраивается таблица переходов из одного состояния в другое т.е. «_жизненный цикл_».


* Класс объекта может быть _абстрактным_. Создать объект с абстрактным классом невозможно.

##### Дерево классов объекта

- `object` Объект (абстрактный);
  - `document` Документ (абстрактный);
    - `address` Адрес;
    - `client` Клиент;
    - `device` Устройство;
    - `job` Задание;
    - `message` Сообщение (абстрактный);
      - `inbox` Входящее;
      - `outbox` Исходящее;
  - `reference` Справочник (абстрактный);
    - `agent` Агент;
    - `calendar` Календарь;
    - `model` Модель;
    - `program` Программа;
    - `scheduler` Планировщик;
    - `vendor` Производитель;
    - `version` Навык;

#### Состояния

* Каждый объект в системе находиться в том или ином состоянии. 
  
* _Состояние_ объекта привязывается к классу объекта.
  
Список состояний для каждого класса объектов индивидуален и может быть настроен пользователем по своему собственному усмотрению.

##### Тип состояния объекта

В системе есть четыре типа состояния объекта:
- `created` Создан;
- `enabled` Включен;
- `disabled` Отключен;
- `deleted` Удалён.

##### Состояние объекта

* Это промежуточное звено в цепи документооборота системы.

Каждому из типов состояния должно соответствовать как минимум одно состояние объекта из чего следует, что каждый объект может находиться как минимум в четырех состояниях. Типы состояний объекта недоступны для изменения пользователю системы, но на базе этих типов пользователь может создать сколько угодно собственных состояний объекта. Первоначальное состояние любого нового объекта в системе это – «Создан». Для каждого состояния объекта задается определенный список действий. Переход из одного состояния объекта в другое происходить только при совершении над ним определенного действия.

#### Действие

* Действие, совершаемое над объектом также, как и состояния объекта задается для каждого класса объекта и формируется из заданного разработчиком системы списка.

На основе заданных действий, путем добавления новых или переопределения уже имеющихся, для каждого класса, пользователь системы может сформировать свой собственный список **_методов_** и **_событий_**.

#### Метод (динамический)

* Это визуальная часть в цепи документооборота системы.

Именно методы отображаются в интерфейсе пользователя в виде кнопок и элементов меню.

#### Событие

* Это реакция на совершаемое над объектом действие.

К каждому событию объекта привязывается написанные на языке PL/pgSQL функции. При возникновении события ядро системы начинает поочередно выполнять код в привязанных к событию функциях (**_каскад событий_**). Выполняемый код может быть абсолютно любым, и иметь разную смысловую нагрузку будь то проверка объекта на переход из одного состояния в другое или информирование пользователя о неправильно заполненных полях.

## API

### Общие параметры запроса для списка
* Для конечных точек возвращающих данные в виде списка `/<endpoint>/list` применимо единное правило и следующее параметры:

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ | ------------
fields | JSON | Массив строк | Список полей. Если не указан, вернёт все доступные поля.
search | JSON | Массив объектов | Условия для отбора данных.
filter | JSON | Объект | Фильтр для отбора данных в виде пары ключ/значение. В качестве ключа указывается имя поля. `filter` является краткой формой `search`.
reclimit | INTEGER | Число | Возвращает не больше заданного числа строк (может быть меньше, если сам запрос выдал меньшее количество строк).
recoffset | INTEGER | Число | Пропускает указанное число строк в запросе.
orderby | JSON | Массив строк | Порядок сортировки (список полей). Допустимо указание `ASC` и `DESC` (`name DESC`)

**Расшифровка параметра `search`**:

Ключ | Тип | Обязательный | Описание
------------ | ------------ | ------------ | ------------
condition | STRING | НЕТ | Условие. Может принимать только два значения `AND` (по умолчанию) или `OR`.
field | STRING | ДА | Наименование поля, к которому применяется условие.
compare | STRING | НЕТ | Сравнение. Может принимать только одно из значений: (`EQL`, `NEQ`, `LSS`, `LEQ`, `GTR`, `GEQ`, `GIN`, `AND`, `OR`, `XOR`, `NOT`, `ISN`, `INN`, `LKE`, `IKE`, `SIM`, `PSX`, `PSI`, `PSN`, `PIN`).
value | STRING | ДА/НЕТ | Искомое значение.
valarr | JSON | ДА/НЕТ | Искомые значения в виде массива. Если указан ключ `valarr`, то ключи `compare` и `value` игнорируются.

**Формат `compare`:**

Значение | Описание
------------ | ------------
EQL | Равно (по умолчанию).
NEQ | Не равно.
LSS | Меньше.
LEQ | Меньше или равно.
GTR | Больше.
GEQ | Больше или равно.
GIN | Для поиска вхождений JSON.
AND | Битовый `AND`.
OR  | Битовый `OR`.
XOR | Битовый `XOR`.
NOT | Битовый `NOT`.
ISN | `IS NULL` (если значение равно null). Ключ `value` должен быть опушен (не указан).
INN | `IS NOT NULL` (если значение не равно null). Ключ `value` должен быть опушен (не указан).
LKE | `LIKE` - Значение ключа `value` должно передаваться вместе со знаком `%` в нужном месте.
IKE | `ILIKE` - Регистр-независимый `LIKE`.
SIM | Регулярные выражения: `SIMILAR TO`
PSX | Регулярное выражение POSIX: `~`
PSI | Регулярное выражение POSIX: `~*`
PSN | Регулярное выражение POSIX: `!~`
PIN | Регулярное выражение POSIX: `!~*`

**Примеры:**

```http request
POST /api/v1/object/geolocation/list HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg

{"filter": {"object": 2, "code": "default"}}
````

```http request
POST /api/v1/address/list HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg

{"fields": ["description"], "search": [{"field": "apartment", "compare": "GEQ", "value": "5"}]}
````

```http request
POST /api/v1/admin/session/list HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg

{"search": [{"field":"userid","compare":"EQL","value":"1004","condition":"OR", "lstr": "("},{"field":"userid","compare":"EQL","value":"1010","condition":"OR", "rstr": ")"},{"field":"created","compare":"LSS","value":"12.08.2020"},{"field":"created","compare":"GEQ","value":"11.08.2020"}]}
````

### Конечные точки

#### Тест подключения
```http request
GET /api/v1/ping
```
Проверить подключение к REST API.

**Параметры запроса:**
НЕТ

**Пример ответа:**
```json
{}
```

#### Проверить время сервера
```http request
GET /api/v1/time
```
Проверить подключение к REST API и получить текущее время сервера.

**Параметры запроса:**
НЕТ

**Пример ответа:**
```json
{
  "serverTime": 1583495795455
}
```

### Регистрация

```http request
POST /api/v1/sign/up
```
Регистрация нового пользователя в системе.

* Для вызова метода необходимо предварительно получить разрешение на авторизацию [учётные данные клиента](https://github.com/ufocomp/module-AuthServer#%D1%83%D1%87%D1%91%D1%82%D0%BD%D1%8B%D0%B5-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5-%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D0%B0).

* Метод вызывается сервером авторизации при регистрации пользователя.

**Параметры:**

Имя | Тип | Значение | Описание
------------ | ------------| ------------ |------------
type | STRING | entity, physical, individual | **Рекомендуемый**. Тип клиента. По умолчанию: physical.
username | STRING | | **Обязательный**. Логин пользователя.
password | STRING | | **Обязательный**. Пароль пользователя.
name | JSON object | | **Рекомендуемый**. Полное наименование компании/Ф.И.О. клиента (пользователя).
phone | STRING | | **Рекомендуемый**. Телефон.
email | STRING | | **Рекомендуемый**. Электронный адрес.
info | JSON  | | **Рекомендуемый**. Дополнительная информация.
description | STRING | | **Рекомендуемый**. Описание.

**Формат `name`:**

Ключ | Тип | Описание
------------ | ------------ | ------------
name | STRING | **Рекомендуемый**. Полное наименование организации/Ф.И.О одной строкой
short | STRING | **Рекомендуемый**. Краткое наименование организации
first | STRING | **Рекомендуемый**. Имя
last | STRING | **Рекомендуемый**. Фамилия
middle | STRING | **Рекомендуемый**. Отчество

Группы:
- `<name>` `[<short>]`
- `<first>` `<last>` `[<middle>]` `[<short>]`

**Формат `info`:** произвольный.

**Описание ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
id | NUMERIC | Идентификатор созданного пользователя.
userid | NUMERIC | Идентификатор учётной записи пользователя.

**Пример:**

Запрос:
```http request
POST /api/v1/sign/up HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg

{"type":"physical","name":{"name":"User Name","short":"User Name","first":"User","last":"Name","middle":""},"phone":"","email":"mail@mail.ru"}
```

Ответ (положительный):
```json
{"id":2,"userid":1009}
```

Ответ (отрицательный):
```json
{"error": {"code": 400, "message": "Учётная запись с электронным адресом \"mail@mail.ru\" уже зарегистрирована."}}
```

### Вход в систему

```http request
POST /api/v1/sign/in
```
Вход в систему по предоставленным данным от пользователя.

* Обратите внимание, что наличие маркера доступа (пользователя) свидетельствует о том, что вход в систему уже был осуществлён.

* Метод вызывается сервером авторизации при входе в систему. Вызов метода на прямую приведет к ошибке.

* Для входа в систему используйте конечные точки сервера авторизации: [Учётные данные владельца ресурса](https://github.com/ufocomp/module-AuthServer#%D1%83%D1%87%D1%91%D1%82%D0%BD%D1%8B%D0%B5-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5-%D0%B2%D0%BB%D0%B0%D0%B4%D0%B5%D0%BB%D1%8C%D1%86%D0%B0-%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%B0).

**Параметры:**

Поле | Тип | Описание
------------ | ------------ | ------------
username | STRING | **Вариативный**. Имя пользователя (Персональный код).
phone | STRING | **Вариативный**. Телефон.
email | STRING | **Вариативный**. Электронный адрес.
password | STRING | **Вариативный**. Пароль. Если `username` это персональный код, то  в `password` нужно передать хеш SHA1(`secret`) от секретного кода пользователя.
agent | STRING | **Игнорируется**. Агент пользователя (браузер). Значение проставляется системой.
host | STRING | **Игнорируется**. IP адрес. Значение проставляется системой.

**Варианты:**
- `<username>` `<password>`
- `<phone>` `<password>`
- `<email>` `<password>`

**Описание ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
session | STRING | Код сессии.
code | STRING | Код авторизации для получения маркера доступа по протоколу OAuth 2.0.
secret | STRING | Секретный ключ (не путать с секретным кодом пользователя) для подписи методом HMAC-SHA256.

**Пример:**

Запрос:
```http request
POST /api/v1/sign/in HTTP/1.1
Host: localhost:8080
Content-Type: application/json

{"username": "user", "password": "user"}
```

Ответ (положительный):
```json
{
  "session":"149d2ae6fa3f82eda21f7dba21824f199d508343",
  "code":"0s4mI+o6tKbubsOirzgxl24/SVoWI8L3ruJYUz/J0+SjbnW12oF9kVe1B642Uw8P",
  "secret":"pkPm5zmHKj04Xr/NH1nKr6ZEUqOfyacC79HLFIQTrBgA6ApbgBvGiJlMBy4XBApt"
}
```

Ответ (отрицательный):
```json
{"error": {"code": 401, "message": "Вход в систему невозможен. Проверьте правильность имени пользователя и повторите ввод пароля."}}
```

### Выход из системы

```http request
POST /api/v1/sign/out
```
Выйти из системы и закрыть сессию.

**Параметры запроса:**

Поле | Тип | Описание
------------ | ------------ | ------------
session | STRING | **Обязательный**. Сессия.
close_all | BOOLEAN | **Необязательный**. Закрыть все сессии.

### Аутентификация

```http request
POST /api/v1/authenticate
```
Аутентифицировать пользователя по коду сессии и секретному коду (сессии).

**Параметры запроса:**

Поле | Тип | Описание
------------ | ------------ | ------------
session | STRING | **Обязательный**. Сессия.
secret | STRING | **Обязательный**. Секретный код.
agent | STRING | **Необязательный**. Агент.
host | STRING | **Необязательный**. IP адрес.

**Описание ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
code | STRING | Код авторизации для получения маркера доступа.

### Авторизация

```http request
POST /api/v1/authorize
```
Авторизовать пользователя по коду сессии.

**Параметры запроса:**

Поле | Тип | Описание
------------ | ------------ | ------------
session | STRING | **Обязательный**. Сессия.

**Описание ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
authorized | BOOLEAN | Результат авторизации.
message | STRING | Сообщение.

### Кто я?
```http request
POST /api/v1/whoami
```
Информация об авторизованном пользователе.

**Параметры запроса:**
НЕТ

**Описание ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
id | NUMERIC | Идентификатор клиента. Может быть null если учётная запись пользователя не связана с клиентом (например вход произведён от имени администратора системы).
userid | NUMERIC | Идентификатор учётной записи пользователя.
suid | NUMERIC | Идентификатор учётной записи системного пользователя.
admin | BOOLEAN | Признак прав доступа на уровне администратора системы.
guest | BOOLEAN | Признак гостевого входа в систему.
profile | JSON | Профиль пользователя (учётной записи).
name | JSON | Наименование клиента.
email | JSON | Справочник электронных адресов клиента.
phone | JSON | Телефонный справочник клиента.
session | JSON | Сессия.
locale | JSON | Локаль.
area | JSON | Зона.
interface | JSON | Интерфейс.

**Описание `profile`:**

Поле | Тип | Описание
------------ | ------------ | ------------
id | NUMERIC | Идентификатор учётной записи.
username | STRING | Логин.
name | STRING | Полное наименование.
family_name | STRING | Фамилия.
given_name | STRING | Имя.
patronymic_name | STRING | Отчество.
email | STRING | Электронный адрес для входа в систему.
email_verified | BOOLEAN | Электронный адрес подтверждён.
phone | STRING | Телефон для входа в систему.
phone_verified | BOOLEAN | Телефон подтверждён.
session_limit | INTEGER | Максимально допустимое количество одновременно открытых сессий.
created | TIMESTAMP | Создан.
locale | STRING | Код локали по умолчанию.
area | STRING | Код зоны (подразделения) по умолчанию.
interface | STRING | Код интерфейса (рабочего места) по умолчанию.
description | STRING | Описание пользователя.
picture | STRING | URL на логотип.
passwordchange | BOOLEAN | Сменить пароль при следующем входе в систему (да/нет).
passwordnotchange | BOOLEAN | Установлен запрет на смену пароля самим пользователем (да/нет).
system | BOOLEAN | Системный пользователь (пользователь СУБД).
status | STRING | Статус пользователя.
state | STRING | Состояние пользователя.
lock_date | TIMESTAMP | Дата блокировки пользователя.
expiry_date | TIMESTAMP | Дата окончания срока действия пароля.
lc_ip | STRING | IP адрес последнего подключения.
input_count | NUMERIC | Счетчик входов.
input_last | TIMESTAMP | Последний вход.
input_error | NUMERIC | Текущие неудавшиеся входы.
input_error_last | TIMESTAMP | Последний неудавшийся вход в систему.
input_error_all | NUMERIC | Общее количество неудачных входов.

<details>
  <summary>Пример ответа</summary>

```json
{
  "id": 14,
  "userid": 1012,
  "suid": 1012,
  "admin": false,
  "guest": true,
  "profile": {
    "id": 1012,
    "username": "user",
    "name": "Пользователь",
    "given_name": null,
    "family_name": null,
    "patronymic_name": null,
    "email": null,
    "email_verified": false,
    "phone": null,
    "phone_verified": false,
    "session_limit": 0,
    "created": "2020-08-05T21:14:18.446581",
    "locale": "ru",
    "area": "default",
    "interface": "I:1:0:0",
    "description": "Пользователь",
    "picture": null,
    "passwordchange": true,
    "passwordnotchange": false,
    "system": "no",
    "status": "active",
    "state": "offline",
    "lock_date": null,
    "expiry_date": null,
    "lc_ip": "127.0.0.1",
    "input_count": 8,
    "input_last": "2020-08-07T15:16:11.939721",
    "input_error": 0,
    "input_error_last": null,
    "input_error_all": 0
  },
  "name": {
    "name": "Пользователь",
    "short": null,
    "first": null,
    "last": null,
    "middle": null
  },
  "email": null,
  "phone": null,
  "session": {
    "code": "4a9adbb079b49aeb7269bbc69c845914cc12127c",
    "created": "2020-08-07T15:16:11.939721",
    "updated": "2020-08-07T15:16:17.028765",
    "agent": "Mozilla/5.0 (X11;Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) advanced-rest-client/14.0.1 Chrome/76.0.3809.146 Electron/6.1.1 Safari/537.36",
    "host": "127.0.0.1"
  },
  "locale": {
    "id": 100000000000,
    "code": "ru",
    "name": "Русский",
    "description": "Русский язык"
  },
  "area": {
    "id": 100000000012,
    "parent": 100000000011,
    "type": 100000000003,
    "code": "default",
    "name": "По умолчанию",
    "description": null,
    "validfromdate": "2020-08-05T20:49:17.092729",
    "validtodate": null
  },
  "interface": {
    "id": 100000000007,
    "sid": "I:1:0:0",
    "name": "Гостевой",
    "description": "Интерфейс для всех"
  }
}
```
</details>

### Локализация

#### Список локализаций
```http request
POST /api/v1/locale
```
Получить список доступных локализаций.

**Параметры запроса:**
НЕТ

#### Текущая локализация
```http request
POST /api/v1/current/locale
```
Получить идентификатор выбранного (текущего) языка.

**Параметры запроса:**
НЕТ

#### Установить локаль
```http request
POST /api/v1/locale/set
```
Установить локаль.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | Идентификатор
code | STRING | en, ru | Код

Группы:
- `<id>`
- `<code>`

### Сущности
```http request
POST /api/v1/entity
```
Получить список сущностей.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

### Классы
```http request
POST /api/v1/class
```
Получить список (дерево) классов объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

### Действия
```http request
POST /api/v1/action
```
Получить список действий.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

#### Выполнить действие
```http request
POST /api/v1/action/execute
```
Выполняет действие над объектом.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
object | NUMERIC |  | **Обязательный**. Идентификатор объекта.
action | NUMERIC |  | **Вариативный**. Идентификатор действия имеет приоритет над `code`.
code | STRING |  | **Вариативный**. Код действия. Можно указать вместо идентификатора действия.
form | JSON |  | **Необязательный**. Параметры HTML формы в формате JSON.

### Типы состояний
```http request
POST /api/v1/state/type
```
Получить список типов состояний объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

### Состояния
```http request
POST /api/v1/state
```
Получить список состояний объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

### Типы объекта
```http request
POST /api/v1/type
```
Получить список типов объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

### Метод

```http request
POST /api/v1/method
```
Получить список методов.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

#### Получить

```http request
POST /api/v1/method/get
```
Получить информацию о методах документооборота.

**Обязателен** как минимум один из параметров указанный в теле запроса:

Имя | Тип | Описание
------------ | ------------ | ------------
object | NUMERIC | Идентификатор объекта
class | NUMERIC | Идентификатор класса
state | NUMERIC | Идентификатор состояния
classcode | STRING | Код класса (вместо идентификатора)
statecode | STRING | Код состояния (вместо идентификатора)

**Пример:**

Запрос:
```http request
POST /api/v1/method/get HTTP/1.1
Host: localhost:8080
Content-Type: application/x-www-form-urlencoded
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg

classcode=client&statecode=enabled
```

Ответ:
```json
[
  {"id":100000000211,"parent":null,"action":100000000053,"actioncode":"disable","label":"Закрыть","visible":true},
  {"id":100000000212,"parent":null,"action":100000000054,"actioncode":"delete","label":"Удалить","visible":true}
]
```

#### Список
```http request
POST /api/v1/method/list
```
Возвращает методы в виде списка.

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

#### Выполнить
```http request
POST /api/v1/method/execute
```
Выполняет динамический метод объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
object | NUMERIC |  | **Обязательный**. Идентификатор объекта.
method | NUMERIC |  | **Вариативный**. Идентификатор метода имеет приоритет над `code`.
code | STRING |  | **Вариативный**. Код действия. Можно указать вместо идентификатора метода.
params | JSON |  | **Необязательный**. Параметры HTML формы в формате JSON.

* Обратите внимание, что в `code` передается не код метода, а код действия.

**Пример:**

Запрос:
```http request
POST /api/v1/method/execute HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg

{"object": 1, "code": "enable"}
```

### Журнал событий
```http request
POST /api/v1/event/log
```
Выводит журнал событий.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
type | CHAR | M, W, E | **Необязательный**. Тип события.
code | INTEGER |  | **Необязательный**. Код.
datefrom | TIMESTAMP |  | **Необязательный**. Дата начала периода.
dateto | TIMESTAMP |  | **Необязательный**. Дата окончания периода.

#### Установить
```http request
POST /api/v1/event/log/set
```
Добавляет запись в журнал событий.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
type | CHAR | M, W, E | **Необязательный**. Тип события.
code | INTEGER |  | **Необязательный**. Код.
text | STRING |  | **Необязательный**. Текст.

#### Получить
```http request
POST /api/v1/event/log/get
```
Возвращает запись в журнале событий.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор записи.
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

#### Список
```http request
POST /api/v1/event/log/list
```
Возвращает записи из журнала событий.

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

### Текущие значения
```http request
POST /api/v1/current/<param>
```
Получить информацию о текущих значениях.

Где `<param>`:

- `session` (сессия);
- `user` (пользователь);
- `userid` (идентификатор пользователя);
- `username` (login пользователя);
- `area` (зона);
- `interface` (интерфейс);
- `locale` (язык);
- `oper_date` (дата операционного дня).

**Параметры запроса:**
НЕТ

#### Сессия
```http request
POST /api/v1/session/set/<param>
```
Установить параметры текущей сессии.

Где `<param>`:

- `area` (зона);
- `interface` (интерфейс);
- `locale` (язык);
- `oper_date` (дата операционного дня).

**Параметры для (`area`, `interface`, `locale`):**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор. Имеет приоритет над кодом.
code | STRING |  | **Обязательный**. Код.

**Параметры для (`oper_date`):**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
oper_date | TIMESTAMP |  | **Обязательный**. Переведёт систему в режим работы с архивной датой. Значение null вернет систему в нормальный режим.

**Параметры запроса:**
НЕТ

#### Объект

##### Класс объекта
```http request
POST /api/v1/object/class
```
Возвращает класс объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.

##### Тип объекта
```http request
POST /api/v1/object/type
```
Возвращает тип объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

##### Состояние объекта
```http request
POST /api/v1/object/state
```
Возвращает состояние объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

##### Удалить объект
```http request
POST /api/v1/object/delete/force
```
Принудительно "удаляет" документ (минуя события документооборота).

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.

### Группы объекта

* Объекты в системе можно группировать.

```http request
POST /api/v1/object/group/<action>
```

Где `<action>` (действие):
- `count` (_Количество_);
- `set` (_Установить_ - _Добавить_ или _Изменить_);
- `get` (_Получить_);
- `list` (_Список_);

#### Количество
```http request
POST /api/v1/object/group/count
```
Количество групп объектов с возможностью указания фильтра отбора данных.

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

#### Установить
```http request
POST /api/v1/object/group/set
```
Создать или изменить группу объектов.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный** для действия _Изменить_. Идентификатор группы.
code | STRING |  | **Рекомендуемый**. Код.
name | STRING |  | **Обязательный**. Наименование.
description | STRING |  | **Необязательный**. Описание.

**ВНИМАНИЕ**: Если значение ключа `id` не указано или равно `null`, то действие считается как _Добавить_, иначе как _Изменить_.

**ВНИМАНИЕ**: Значения не указанных ключей считаются как `null`.

**ВНИМАНИЕ**: Для действия _Изменить_ не нужно передавать значения всех ключей, достаточно передать только те, которые требуется поменять.

**ВНИМАНИЕ**: Ответом на запрос будут данные действия _Получить_.

#### Получить
```http request
POST /api/v1/object/group/get
```
Получить данные группы.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Вариативный**. Идентификатор группы (имеет приоритет над кодом группы).
code | STRING |  | **Вариативный**. Код группы.
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

**Формат ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
id | NUMERIC | Идентификатор группы.
owner | NUMERIC | Идентификатор учётной записи (владельца группы).
code | STRING | Код.
name | STRING | Наименование.
description | STRING | Описание.

#### Список
```http request
POST /api/v1/object/group/list
```
Получить данные по группам объектов в виде списка с возможностью указания фильтра отбора.

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

### Участники группы объекта

```http request
POST /api/v1/object/group/member/<action>
```

Где `<action>` (действие):
- `add` (_Добавить_);
- `delete` (_Удалить_);

#### Участники
```http request
POST /api/v1/object/group/member
```
Получить список объектов-участников группы.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Вариативный**. Идентификатор группы (имеет приоритет над кодом группы).
code | STRING |  | **Вариативный**. Код группы.

**Формат ответа:**

[Объект](#объект-(object))

#### Добавить
```http request
POST /api/v1/object/group/member/add
```
Добавить объект в группу.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Вариативный**. Идентификатор группы (имеет приоритет над кодом группы).
code | STRING |  | **Вариативный**. Код группы.
object | NUMERIC |  | **Обязательный**. Идентификатор объекта.

#### Удалить
```http request
POST /api/v1/object/group/member/delete
```
Удалить объект из группы.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Вариативный**. Идентификатор группы (имеет приоритет над кодом группы).
code | STRING |  | **Вариативный**. Код группы.
object | NUMERIC |  | **Обязательный**. Идентификатор объекта.

*ВНИМАНИЕ:* Если из группы будут удалены все объекты сама группа будет удалена автоматически.

### Файлы объекта
```http request
POST /api/v1/object/file
```
Получить или установить связь объекта с файлом на сервере или содержимое файла.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
files | JSON array | null OR json | **Вариативный**. Массив JSON объектов с описанием файлов.

**Формат `files`:**

Ключ | Тип | Описание
------------ | ------------ | ------------
name | STRING | **Обязательный**. Наименование файла на сервере (включая путь).
path | STRING | **Необязательный**. Только путь к файлу (на сервере).
size | INTEGER | **Необязательный**. Размер файла (осторожнее с null или 0).
date | TIMESTAMP | **Необязательный**. Дата и время файла.
data | STRING | **Необязательный**. Содержимое файла (если нужно) в формате BASE64.
hash | STRING | **Необязательный**. Хеш файла.
text | STRING | **Необязательный**. Описание файла.
type | STRING | **Необязательный**. Тип файла.

**ВНИМАНИЕ**: Если значение `files` не указано или равно `null`, то метод работает как `Получить` иначе как `Установить`.

#### Установить
```http request
POST /api/v1/object/files/set
```
Установить связь объекта с файлом на сервере.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
files | JSON array | | **Обязательный**. Массив JSON объектов с описанием файлов.

**ВНИМАНИЕ**: Значения не указанных ключей считаются как `null`.

**ВНИМАНИЕ**: Если значение ключа `size` не указано или равно нулю, то действие считается как `Удалить`.

#### Получить
```http request
POST /api/v1/object/files/get
```
Получить связь объекта с файлом на сервере.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
name | STRING |  | **Обязательный**. Наименование файла на сервере (включая путь).
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

#### Список
```http request
POST /api/v1/object/files/list
```
Получить связи объекта с файлами на сервере в виде списка.

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

### Данные объекта
```http request
POST /api/v1/object/data
```
Получить или установить произвольные данные для объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
data | JSON array | null OR json | **Вариативный**. Массив JSON объектов с произвольными данными.

**Формат `data`:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
type | STRING | text, json, xml | **Обязательный**. Код типа произвольных данных объекта.
code | STRING | | **Обязательный**. Код произвольных данных.
data | STRING | | **Вариативный**. Произвольные данные.

**ВНИМАНИЕ**: Если значение `data` не указано или равно `null`, то метод работает как `Получить` иначе как `Установить`.

#### Установить
```http request
POST /api/v1/object/data/set
```
Установить произвольные данные для объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
data | JSON array |  | **Обязательный**. Массив JSON объектов с произвольными данными.

**ВНИМАНИЕ**: Значения не указанных ключей считаются как `null`.

**ВНИМАНИЕ**: Если значение ключа `data` не указано или равно `null`, то действие считается как `Удалить`.

**Пример:**

Запрос (установить):
```http request
POST /api/v1/object/data/set HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg

{"id": 2, "data": [{"type": "json", "code": "unique.code", "data": "{\"search\": [{\"field\": \"validfromdate\", \"value\": \"24.03.2020 00:31:23\", \"compare\": \"LEQ\"}, {\"field\": \"validtodate\", \"value\": \"24.03.2020 00:31:23\", \"compare\": \"GTR\"}]}"}]}
```

Запрос (удалить):
```http request
POST /api/v1/object/data/set HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg

{"id": 2, "data": [{"type": "json", "code": "unique.code", "data": null}]}
```

#### Получить
```http request
POST /api/v1/object/data/get
```
Получить произвольные данные для объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
type | NUMERIC |  | **Вариативный**. Идентификатор типа произвольных данных объекта (имеет приоритет над кодом типа данных).
typecode | STRING | text, json, xml | **Вариативный**. Код типа произвольных данных объекта.
code | STRING | | **Обязательный**. Код произвольных данных.
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

**Пример:**

Запрос:
```http request
POST /api/v1/object/data/get HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg

{"id": 2, "typecode": "json", "code": "unique.code"}
```

#### Список
```http request
POST /api/v1/object/data/list
```
Получить произвольные данные для объекта в виде списка.

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

Запрос:
```http request
POST /api/v1/object/data/list HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg

{"filter": {"object": 2, "typecode": "json", "code": "unique.code"}}
```

### Геолокация объекта
```http request
POST /api/v1/object/geolocation
```
Получить или установить координаты геолокации для объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
coordinates | JSON array | null OR json | **Вариативный**. Массив JSON объектов с координатами.

**Формат `coordinates`:**

Ключ | Тип | Описание
------------ | ------------ | ------------
code | STRING | **Необязательный**. Код. По умолчанию `default`. Может использоваться в качестве идентификатора места положения (`home`, `work`)
latitude | NUMERIC | **Обязательный**. Широта.
longitude | NUMERIC | **Обязательный**. Долгота.
accuracy | NUMERIC | **Необязательный**. Точность (высота над уровнем моря).
label | STRING | **Необязательный**. Метка.
description | STRING | **Необязательный**. Описание.
data | JSON | **Необязательный**. Данные в произвольном формате.

**ВНИМАНИЕ**: Если значение `coordinates` не указано или равно `null`, то метод работает как `Получить` иначе как `Установить`.

#### Установить
```http request
POST /api/v1/object/geolocation/set
```
Установить координаты геолокации для объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
coordinates | JSON array |  | **Обязательный**. Массив JSON объектов с координатами.

**ВНИМАНИЕ**: Координаты геолокации для объекта хранятся в виде истории по дате и времени добавления.

#### Получить
```http request
POST /api/v1/object/geolocation/get
```
Получить последние координаты геолокации для объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

**ВНИМАНИЕ**: На период может повлиять значение `oper_date` (дата операционного дня) см. [Текущие значения](#текущие-значения).

**Формат ответа:**

Ключ | Тип | Описание
------------ | ------------ | ------------
id | NUMERIC | Идентификатор записи.
object | NUMERIC | Идентификатор объекта.
code | STRING | Код. По умолчанию `default`. Может использоваться в качестве идентификатора места положения (`home`, `work`)
latitude | NUMERIC | Широта.
longitude | NUMERIC | Долгота.
accuracy | NUMERIC | Точность (высота над уровнем моря).
label | STRING | Метка.
description | STRING | Описание.
data | JSON | Данные в произвольном формате.
validfromdate | TIMESTAMP | Дата начала периода действия.
validtodate | TIMESTAMP | Дата окончания периода действия.

Формат `data` произвольный. Если данные передавались чезер [потоковый сервер](https://github.com/ufocomp/process-StreamServer), то в `data` в поле `device` будут содержаться данные GPS устройства.

**Формат `data`:**

```
{
  "device": {
    "id": numeric,
    "identity": string,
    "serial": string,
    "battery": numeric
  }
}
```

**Пример ответа:**
````json
{
  "id": 70,
  "object": 63,
  "code": "default",
  "latitude": 54.7119513000032,
  "longitude": 20.5316411000007,
  "accuracy": 0,
  "label": "ANDROID-test",
  "description": null,
  "validfromdate": "2020-12-27T16:36:03.5391+03:00",
  "validtodate": "2020-12-27T17:08:05.090964+03:00",
  "data": {
    "device": {
      "id": 63,
      "serial": "test",
      "battery": 37,
      "identity": "ANDROID-test"
    }
  }
}
````
#### Список
```http request
POST /api/v1/object/geolocation/list
```
Получить координаты геолокации в виде списка.

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

### Адрес объекта
```http request
POST /api/v1/object/address
```
Получить или установить почтовый адрес объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
addresses | JSON array | null OR json | **Вариативный**. Массив JSON объектов с адресами.

**Формат `addresses`:**

Ключ | Тип | Описание
------------ | ------------ | ------------
id | NUMERIC | **Вариативный**. Идентификатор адреса.
parent | NUMERIC | **Необязательный**. Идентификатор родителя.
type | STRING | **Необязательный**. Код типа адреса.
code | STRING | **Обязательный** если иные ключи не указаны. Код: ФФ СС РРР ГГГ ППП УУУУ. Где: ФФ - код страны; СС - код субъекта РФ; РРР - код района; ГГГ - код города; ППП - код населенного пункта; УУУУ - код улицы.
index | STRING | **Необязательный**. Почтовый индекс.
country | STRING | **Необязательный**. Страна.
region | STRING | **Необязательный**. Регион.
district | STRING | **Необязательный**. Район.
city | STRING | **Необязательный**. Город.
settlement | STRING | **Необязательный**. Населённый пункт.
street | STRING | **Необязательный**. Улица.
house | STRING | **Необязательный**. Дом.
building | STRING | **Необязательный**. Корпус.
structure | STRING | **Необязательный**. Строение.
apartment | STRING | **Необязательный**. Квартира.
address | STRING | **Необязательный**. Полный адрес.

**ВНИМАНИЕ**: Если значение `id` не указано или равно `null`, то будет создан новый почтовый адрес, иначе изменён.

**ВНИМАНИЕ**: Если значение `addresses` не указано или равно `null`, то метод работает как `Получить` иначе как `Установить`.

#### Установить
```http request
POST /api/v1/object/address/set
```
Связывает ранее созданный почтовый адрес с объектом.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
address | JSON array |  | **Обязательный**. Идентификатор адреса.
datefrom | TIMESTAMP |  | **Необязательный**. Дата начала периода.

#### Получить
```http request
POST /api/v1/object/address/get
```
Получить почтовый адрес объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

#### Список
```http request
POST /api/v1/object/address/list
```
Получить координаты геолокации в виде списка.

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

### КЛАДР

* Классификатор адресов Российской Федерации (КЛАДР) — ведомственный классификатор ФНС России, созданный для распределения территорий между налоговыми инспекциями и автоматизированной рассылки корреспонденции.

В систему, для удобства создания почтовых адресов (класс `address`), интегрирован справочник КЛАДР. Реализован он в виде дерева адресов. Глубина реализации: до улиц.

#### Получить
```http request
POST /api/v1/address/tree/get
```
Возвращает адрес из справочника адресов КЛАДР.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор справочника.
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

#### Список
```http request
POST /api/v1/address/tree/list
```
Возвращает справочник адресов КЛАДР в виде списка.

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

#### История
```http request
POST /api/v1/address/tree/history
```
Возвращает историю из справочника адресов КЛАДР.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Вариативный**. Идентификатор справочника. Имеет приоритет над `code`.
code | STRING |  | **Вариативный**. Код из справочника адресов: ФФ СС РРР ГГГ ППП УУУУ.

**Описание `code`:**

|  ФФ   |   СС   |   РРР   |   ГГГ   |    ППП   |    УУУУ   |
| :---: | :----: | :-----: | :-----: | :------: |  :------: |
| Код страны | Код субъекта РФ | Код района | Код города | Код населенного пункта | Код улицы |

#### Строка
```http request
POST /api/v1/address/tree/string
```
Возвращает адрес из справочника адресов КЛАДР в виде строки.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
code | STRING |  | **Обязательный**. Код из справочника адресов: ФФ СС РРР ГГГ ППП УУУУ.
short | INTEGER |  | **Необязательный**. Сокращение: 0 - нет; 1 - слева; 2 - справа.
level | INTEGER |  | **Необязательный**. Ограничение уровня вложенности.

### Верификация (код подтверждения)

#### Получить

```http request
POST /api/v1/verification/<agent>/code
```
Создать и получить код подтверждения.

Где `<agent>`:
- mail - Для электронного адреса;
- phone - Для номера телефона;

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
code | STRING |  | **Необязательный**. Код подтверждения. Если код не указан система сгенерирует его автоматически.

**Формат ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
id | NUMERIC | Идентификатор.
type | STRING | Тип: mail - электронный адрес; phone - номера телефона.
code | STRING | Код подтверждения.
used | BOOL | Использован: Да/Нет.
validfromdate | TIMESTAMP | Дата начала периода действия.
validtodate | TIMESTAMP | Дата окончания периода действия.

#### Сверить
```http request
POST /api/v1/verification/<agent>/confirm
```
Сверяет код подтверждения.

Где `<agent>`:
- mail - Электронный адрес;
- phone - Номер телефона;

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
code | STRING |  | **Обязательный**. Код подтверждения.

**Формат ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
result | BOOL | Результат: Да/Нет.
message | STRING | Текст ошибки.

#### Получить
```http request
POST /api/v1/verification/get
```
Возвращает код подтверждения.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор записи.
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

#### Список
```http request
POST /api/v1/verification/list
```
Возвращает коды подтверждения.

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

## Реестр

* Система предоставляет возможность хранить данные в реестре по аналогии с реестром в операционной системе Windows.

Для доступа к данным нужно указать:
1. **Идентификатор** - `Id`;
1. **Наименование значения** - `ValueName`.

или

1. **Ключ** - `Key`;
1. **Подключ** - `SubKey`;
1. **Наименование значения** - `ValueName`.

**Ключ** имеет два фиксированных значения (две категории):

Имя | Значение | Описание
------------ | ------------  |------------
Текущие настройки | CURRENT_CONFIG | В данной категории хранится информация доступная всем пользователям.
Текущий пользователь | CURRENT_USER | В данной категории хранится информация доступная только зарегистрированному пользователю.

**Подключ** - это строка-путь к значениям. В качестве разделителя используется обратная косая черта (слеш) ` \ `.

* Подключ по своему формату напоминает путь к файлам в системах Windows.

* Обязательное условие: Подключ не должен начинаться и заканчиваться знаком обратной черты - ` \ `!

### Конечные точки

#### Список
```http request
POST /api/v1/registry/list
```
Реестр в виде списка.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC | | **Необязательный**. Идентификатор записи в реестре.
key | NUMERIC | | **Необязательный**. Идентификатор ключа.
subkey | NUMERIC | | **Необязательный**. Идентификатор подключа.
extended | NUMERIC | | **Необязательный**. Расширенный формат значения. При `true` формат `value` будет табличным при `false` в виде вложенного JSON объекта.

```http request
POST /api/v1/registry/list HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg
```
**Формат ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
id | NUMERIC | Идентификатор записи в реестре.
key | NUMERIC | Идентификатор ключа.
keyname | STRING | Наименование ключа.
parent | NUMERIC | Идентификатор ключа родителя.
subkey | NUMERIC | Идентификатор подключа.
subkeyname | STRING | Наименование подключа.
level | NUMERIC | Уровень иерархии.
valuename | STRING | Наименование значения.
value | JSON | Значение. При `extended: false` (по умолчанию).

**Формат `value`:**

Поле | Тип | Описание
------------ | ------------ | ------------
vtype | INTEGER | Тип значения. 0 - Целое число; 1 - Число с произвольной точностью; 2 - Дата и время; 3 - Строка; 4 - Логический
vinteger | INTEGER | Целое число.
vnumeric | NUMERIC | Число с произвольной точностью.
vdatetime | TIMESTAMP | Дата и время.
vstring | STRING | Строка.
vboolean | BOOLEAN | Логический.

#### Ключ
```http request
POST /api/v1/registry/key
```
Ключи реестра.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC | | **Необязательный**. Идентификатор записи в реестре.
root | NUMERIC | | **Необязательный**. Идентификатор записи в реестре.
parent | NUMERIC | | **Необязательный**. Идентификатор подключа.
key | NUMERIC | | **Необязательный**. Идентификатор ключа.

#### Значение
```http request
POST /api/v1/registry/value
```
Значения в реестре.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC | | **Необязательный**. Идентификатор записи в реестре.
key | NUMERIC | | **Необязательный**. Идентификатор ключа.
extended | NUMERIC | | **Необязательный**. Расширенный формат значения. При `true` формат `value` будет табличным при `false` в виде вложенного JSON объекта.

**Формат ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
id | NUMERIC | Идентификатор записи в реестре.
key | NUMERIC | Идентификатор ключа.
keyname | STRING | Наименование ключа.
subkey | NUMERIC | Идентификатор подключа.
subkeyname | STRING | Наименование подключа.
valuename | STRING | Наименование значения.
value | JSON | Значение. При `extended: false` (по умолчанию).

**Формат `value`:**

Поле | Тип | Описание
------------ | ------------ | ------------
vtype | INTEGER | Тип значения. 0 - Целое число; 1 - Число с произвольной точностью; 2 - Дата и время; 3 - Строка; 4 - Логический
vinteger | INTEGER | Целое число.
vnumeric | NUMERIC | Число с произвольной точностью.
vdatetime | TIMESTAMP | Дата и время.
vstring | STRING | Строка.
vboolean | BOOLEAN | Логический.

#### Вернуть ключ
```http request
POST /api/v1/registry/get/key
```
Возвращает ключ реестра.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC | | **Необязательный**. Идентификатор ключа.

**Формат ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
id | NUMERIC | Идентификатор записи в реестре.
root | NUMERIC | Идентификатор корневого ключа.
parent | NUMERIC | Идентификатор ключа родителя.
key | STRING | Наименование ключа.
level | NUMERIC | Уровень иерархии.

#### Перечислить ключи
```http request
POST /api/v1/registry/enum/key
```
Перечисляет ключи по указанному пути.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
key | STRING | CURRENT_CONFIG, CURRENT_USER | **Обязательный**. Наименование ключа.
subkey | STRING | | **Обязательный**. Наименование подключа.

**Формат ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
id | NUMERIC | Идентификатор записи в реестре.
root | NUMERIC | Идентификатор корневого ключа.
parent | NUMERIC | Идентификатор ключа родителя.
key | STRING | Наименование ключа.
level | NUMERIC | Уровень иерархии.

**Пример запроса:**

```http request
POST /api/v1/registry/enum/key HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg
Content-Type: application/json

{"key": "CURRENT_CONFIG", "subkey": "CONFIG"}
```
**Пример ответа:**

```json
[
  {
"id": 3,
"key": "CURRENT_CONFIG",
"subkey": "CONFIG\\Department"
},
  {
"id": 132,
"key": "CURRENT_CONFIG",
"subkey": "CONFIG\\CurrentProject"
}
]
```

**Пример запроса:**

```http request
POST /api/v1/registry/enum/key HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg
Content-Type: application/json

{"key": "CURRENT_CONFIG", "subkey": "CONFIG\\Department"}
```

**Пример ответа:**

```json
[
  {
"id": 4,
"key": "CURRENT_CONFIG",
"subkey": "CONFIG\\Department\\root"
},
  {
"id": 20,
"key": "CURRENT_CONFIG",
"subkey": "CONFIG\\Department\\system"
},
  {
"id": 36,
"key": "CURRENT_CONFIG",
"subkey": "CONFIG\\Department\\guest"
},
  {
"id": 52,
"key": "CURRENT_CONFIG",
"subkey": "CONFIG\\Department\\all"
},
  {
"id": 68,
"key": "CURRENT_CONFIG",
"subkey": "CONFIG\\Department\\default"
}
]
```

#### Перечислить значения
```http request
POST /api/v1/registry/enum/value
```
Перечисляет значения по указанному пути.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
key | STRING | CURRENT_CONFIG, CURRENT_USER | **Обязательный**. Наименование ключа.
subkey | STRING | | **Обязательный**. Наименование подключа.
extended | NUMERIC | | **Необязательный**. Расширенный формат значения. При `true` формат `value` будет табличным при `false` в виде вложенного JSON объекта.

**Формат ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
id | NUMERIC | Идентификатор записи в реестре.
key | STRING | Наименование ключа.
subkey | STRING | Наименование подключа.
valuename | STRING | Наименование значения.
value | JSON | Значение. При `extended: false` (по умолчанию).

**Формат `value`:**

Поле | Тип | Описание
------------ | ------------ | ------------
vtype | INTEGER | Тип значения. 0 - Целое число; 1 - Число с произвольной точностью; 2 - Дата и время; 3 - Строка; 4 - Логический
vinteger | INTEGER | Целое число.
vnumeric | NUMERIC | Число с произвольной точностью.
vdatetime | TIMESTAMP | Дата и время.
vstring | STRING | Строка.
vboolean | BOOLEAN | Логический.

**Пример запроса:**

```http request
POST /api/v1/registry/enum/value HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg
Content-Type: application/json

{"key": "CURRENT_CONFIG", "subkey": "CONFIG\\CurrentProject"}
```

#### Записать
```http request
POST /api/v1/registry/write
```
Сохранить данные в реестре.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC | | **Вариативный** Идентификатор ключа в реестре. Имеет приоритете над парой `Key` и `SubKey`
key | STRING | CURRENT_CONFIG, CURRENT_USER | **Вариативный**. Наименование ключа.
subkey | STRING | | **Вариативный**. Наименование подключа.
name | STRING | | **Обязательный**. Наименование значения. При отсутствии будет создано.
type | INTEGER | 0, 1, 2, 3, 4 | **Обязательный**. Тип значения. 0 - Целое число; 1 - Число с произвольной точностью; 2 - Дата и время; 3 - Строка; 4 - Логический
data | ANYNONARRAY | | **Обязательный**. Данные в соответствии с указанным типом.

**Пример запроса:**

```http request
POST /api/v1/registry/write HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg
Content-Type: application/json

{"key": "CURRENT_CONFIG", "subkey": "CONFIG\\CurrentProject", "name": "Name", "type": 3, "data": "Project name"}
```

#### Записать (целое число)
```http request
POST /api/v1/registry/write/integer
```
Сохранить целое число в реестре.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC | | **Вариативный** Идентификатор ключа в реестре. Имеет приоритете над парой `Key` и `SubKey`
key | STRING | CURRENT_CONFIG, CURRENT_USER | **Вариативный**. Наименование ключа.
subkey | STRING | | **Вариативный**. Наименование подключа.
name | STRING | | **Обязательный**. Наименование значения. При отсутствии будет создано.
value | INTEGER | | **Обязательный**. Значение.

**Пример запроса:**

```http request
POST /api/v1/registry/write/integer HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg
Content-Type: application/json

{"key": "CURRENT_CONFIG", "subkey": "CONFIG\\CurrentProject", "name": "IntegerValue", "value": 1}
```

#### Записать (вещественное число)
```http request
POST /api/v1/registry/write/numeric
```
Сохранить вещественное число в реестре.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC | | **Вариативный** Идентификатор ключа в реестре. Имеет приоритете над парой `Key` и `SubKey`
key | STRING | CURRENT_CONFIG, CURRENT_USER | **Вариативный**. Наименование ключа.
subkey | STRING | | **Вариативный**. Наименование подключа.
name | STRING | | **Обязательный**. Наименование значения. При отсутствии будет создано.
value | NUMERIC | | **Обязательный**. Значение.

**Пример запроса:**

```http request
POST /api/v1/registry/write/numeric HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg
Content-Type: application/json

{"key": "CURRENT_CONFIG", "subkey": "CONFIG\\CurrentProject", "name": "NumberValue", "value": 0.1}
```

#### Записать (дату и время)
```http request
POST /api/v1/registry/write/datetime
```
Сохранить дату и время в реестре.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC | | **Вариативный** Идентификатор ключа в реестре. Имеет приоритете над парой `Key` и `SubKey`
key | STRING | CURRENT_CONFIG, CURRENT_USER | **Вариативный**. Наименование ключа.
subkey | STRING | | **Вариативный**. Наименование подключа.
name | STRING | | **Обязательный**. Наименование значения. При отсутствии будет создано.
value | TIMESTAMP | | **Обязательный**. Значение.

**Пример запроса:**

```http request
POST /api/v1/registry/write/datetime HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg
Content-Type: application/json

{"key": "CURRENT_CONFIG", "subkey": "CONFIG\\CurrentProject", "name": "DateTimeValue", "value": "2020-01-02T03:04:05"}
```

#### Записать (строку)
```http request
POST /api/v1/registry/write/string
```
Сохранить строку в реестре.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC | | **Вариативный** Идентификатор ключа в реестре. Имеет приоритете над парой `Key` и `SubKey`
key | STRING | CURRENT_CONFIG, CURRENT_USER | **Вариативный**. Наименование ключа.
subkey | STRING | | **Вариативный**. Наименование подключа.
name | STRING | | **Обязательный**. Наименование значения. При отсутствии будет создано.
value | STRING | | **Обязательный**. Значение.

**Пример запроса:**

```http request
POST /api/v1/registry/write/string HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg
Content-Type: application/json

{"key": "CURRENT_CONFIG", "subkey": "CONFIG\\CurrentProject", "name": "StringValue", "value": "Any string"}
```

#### Записать (логическое значение)
```http request
POST /api/v1/registry/write/boolean
```
Сохранить логическое значение в реестре.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC | | **Вариативный** Идентификатор ключа в реестре. Имеет приоритете над парой `Key` и `SubKey`
key | STRING | CURRENT_CONFIG, CURRENT_USER | **Вариативный**. Наименование ключа.
subkey | STRING | | **Вариативный**. Наименование подключа.
name | STRING | | **Обязательный**. Наименование значения. При отсутствии будет создано.
value | BOOLEAN | | **Обязательный**. Значение.

**Пример запроса:**

```http request
POST /api/v1/registry/write/boolean HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg
Content-Type: application/json

{"key": "CURRENT_CONFIG", "subkey": "CONFIG\\CurrentProject", "name": "LogicValue", "value": true}
```

#### Прочитать
```http request
POST /api/v1/registry/read
```
Получить данные из реестра.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC | | **Вариативный** Идентификатор ключа в реестре. Имеет приоритете над парой `Key` и `SubKey`
key | STRING | CURRENT_CONFIG, CURRENT_USER | **Вариативный**. Наименование ключа.
subkey | STRING | | **Вариативный**. Наименование подключа.
name | STRING | | **Обязательный**. Наименование значения.

**Формат ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
vtype | INTEGER | Тип значения. 0 - Целое число; 1 - Число с произвольной точностью; 2 - Дата и время; 3 - Строка; 4 - Логический
vinteger | INTEGER | Целое число.
vnumeric | NUMERIC | Число с произвольной точностью.
vdatetime | TIMESTAMP | Дата и время.
vstring | STRING | Строка.
vboolean | BOOLEAN | Логический.

**Пример запроса:**

```http request
POST /api/v1/registry/read HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg
Content-Type: application/json

{"key": "CURRENT_CONFIG", "subkey": "CONFIG\\CurrentProject", "name": "Name"}
```

#### Прочитать (целое число)
```http request
POST /api/v1/registry/read/integer
```
Получить целое число из реестра.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC | | **Вариативный** Идентификатор ключа в реестре. Имеет приоритете над парой `Key` и `SubKey`
key | STRING | CURRENT_CONFIG, CURRENT_USER | **Вариативный**. Наименование ключа.
subkey | STRING | | **Вариативный**. Наименование подключа.
name | STRING | | **Обязательный**. Наименование значения.

**Формат ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
value | INTEGER | Значение.

**Пример запроса:**

```http request
POST /api/v1/registry/read/integer HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg
Content-Type: application/json

{"key": "CURRENT_CONFIG", "subkey": "CONFIG\\CurrentProject", "name": "IntegerValue"}
```

#### Прочитать (вещественное число)
```http request
POST /api/v1/registry/read/numeric
```
Получить вещественное число из реестра.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC | | **Вариативный** Идентификатор ключа в реестре. Имеет приоритете над парой `Key` и `SubKey`
key | STRING | CURRENT_CONFIG, CURRENT_USER | **Вариативный**. Наименование ключа.
subkey | STRING | | **Вариативный**. Наименование подключа.
name | STRING | | **Обязательный**. Наименование значения.

**Формат ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
value | NUMERIC | Значение.

**Пример запроса:**

```http request
POST /api/v1/registry/read/numeric HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg
Content-Type: application/json

{"key": "CURRENT_CONFIG", "subkey": "CONFIG\\CurrentProject", "name": "NumberValue"}
```

#### Прочитать (дату и время)
```http request
POST /api/v1/registry/read/datetime
```
Получить дату и время из реестра.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC | | **Вариативный** Идентификатор ключа в реестре. Имеет приоритете над парой `Key` и `SubKey`
key | STRING | CURRENT_CONFIG, CURRENT_USER | **Вариативный**. Наименование ключа.
subkey | STRING | | **Вариативный**. Наименование подключа.
name | STRING | | **Обязательный**. Наименование значения. При отсутствии будет создано.

**Формат ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
value | TIMESTAMP | Значение.

**Пример запроса:**

```http request
POST /api/v1/registry/read/datetime HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg
Content-Type: application/json

{"key": "CURRENT_CONFIG", "subkey": "CONFIG\\CurrentProject", "name": "DateTimeValue"}
```

#### Прочитать (строку)
```http request
POST /api/v1/registry/read/string
```
Получить строку в реестре.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC | | **Вариативный** Идентификатор ключа в реестре. Имеет приоритете над парой `Key` и `SubKey`
key | STRING | CURRENT_CONFIG, CURRENT_USER | **Вариативный**. Наименование ключа.
subkey | STRING | | **Вариативный**. Наименование подключа.
name | STRING | | **Обязательный**. Наименование значения. При отсутствии будет создано.

**Формат ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
value | STRING | Значение.

**Пример запроса:**

```http request
POST /api/v1/registry/read/string HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg
Content-Type: application/json

{"key": "CURRENT_CONFIG", "subkey": "CONFIG\\CurrentProject", "name": "StringValue"}
```

#### Прочитать (логическое значение)
```http request
POST /api/v1/registry/read/boolean
```
Получить логическое значение из реестра.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC | | **Вариативный** Идентификатор ключа в реестре. Имеет приоритете над парой `Key` и `SubKey`
key | STRING | CURRENT_CONFIG, CURRENT_USER | **Вариативный**. Наименование ключа.
subkey | STRING | | **Вариативный**. Наименование подключа.
name | STRING | | **Обязательный**. Наименование значения. При отсутствии будет создано.

**Формат ответа:**

Поле | Тип | Описание
------------ | ------------ | ------------
value | BOOLEAN | Значение.

**Пример запроса:**

```http request
POST /api/v1/registry/read/boolean HTTP/1.1
Host: localhost:8080
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.[сокращенно для краткости].NorYsi-Ht826HUFCEArVZ60_dEUmYiJYXubnTyweIMg
Content-Type: application/json

{"key": "CURRENT_CONFIG", "subkey": "CONFIG\\CurrentProject", "name": "LogicValue"}
```

# Конфигурация

**Подробное описание конфигурации смотрите в репозитории Вашего проекта**:

- [Ship Safety ERP](https://github.com/ufocomp/apostol-serp/blob/master/doc/REST-API-ru.md#%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D1%8F)
- [Plugme](https://github.com/ufocomp/apostol-plugme/blob/master/doc/REST-API-ru.md#%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D1%8F)
- [Fenomy](https://github.com/ufocomp/apostol-fenomy/blob/master/doc/REST-API-ru.md#%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D1%8F)

## Конечные точки

### Общие конечные точки

* Для всех _объектов_ имеются общие конечные точки:

#### Описание конечных точек классов [здесь](#конечные-точки-классов).

```http request
POST /api/v1/<class>/<action>
```

Где `<class>` - это не абстрактный класс из [дерева классов объекта](#классы).

Где `<action>` (действие):
- `type` (_Тип_);
- `method` (_Метод_);
- `count` (_Количество_);
- `set` (_Установить_ - _Добавить_ или _Изменить_);
- `get` (_Получить_);
- `list` (_Список_);

##### Действие тип
```http request
POST /api/v1/<class>/type
```
Информация о типе объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

##### Действие метод
```http request
POST /api/v1/<class>/method
```
Информация о методах объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.

##### Действие количество
```http request
POST /api/v1/<class>/count
```
Количество объектов с возможностью указания фильтра отбора данных.

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

##### Действие установить
```http request
POST /api/v1/<class>/set
```
Установить данные объекта.

[Параметры](#параметры-запросов)

**ВНИМАНИЕ**: Если значение ключа `id` не указано или равно `null`, то действие считается как _Добавить_, иначе как _Изменить_.

**ВНИМАНИЕ**: Значения не указанных ключей считаются как `null`.

**ВНИМАНИЕ**: Для действия _Изменить_ не нужно передавать значения всех ключей, достаточно передать только те, которые требуется поменять.

**ВНИМАНИЕ**: Ответом на запрос будут данные действия [_Получить_](#действие-получить).

##### Действие получить
```http request
POST /api/v1/<class>/get
```
Получить данные объекта.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.
fields | JSON array |  | **Необязательный**. Массив JSON string полей в таблице, если не указано то запрос вернет все поля.

**ВНИМАНИЕ**: Формат данных в ответе уникален для каждого класса и подробно описан в разделе [класс-таблицы](#класс-таблицы).

##### Действие список
```http request
POST /api/v1/<class>/list
```
Получить данные объекта в виде списка с возможностью указания фильтра отбора.

**Параметры запроса:**
[Общие параметры запроса для списка](#общие-параметры-запроса-для-списка)

## Конечные точки классов

### Адрес (`address`)

#### Общие
```http request
POST /api/v1/address/[ type | method | count | set | get | list ]
```
[Общие конечные точки](#общие-конечные-точки)

#### Параметры запросов

* Параметры запросов для действия [_установить_](#действие-установить).

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный** для действия _изменить_. Идентификатор объекта.
parent | NUMERIC |  | **Необязательный**. Идентификатор объекта родителя.
type | STRING |  | **Необязательный**. Код типа.
code | STRING |  | **Рекомендуемый**. Код: ФФ СС РРР ГГГ ППП УУУУ. Где: ФФ - код страны; СС - код субъекта РФ; РРР - код района; ГГГ - код города; ППП - код населенного пункта; УУУУ - код улицы.
index | STRING |  | **Рекомендуемый**. Почтовый индекс.
country | STRING |  | **Рекомендуемый**. Страна.
region | STRING |  | **Рекомендуемый**. Регион.
district | STRING |  | **Рекомендуемый**. Район.
city | STRING |  | **Рекомендуемый**. Город.
settlement | STRING |  | **Рекомендуемый**. Населённый пункт.
street | STRING |  | **Рекомендуемый**. Улица.
house | STRING |  | **Рекомендуемый**. Дом.
building | STRING |  | **Рекомендуемый**. Корпус.
structure | STRING |  | **Рекомендуемый**. Строение.
apartment | STRING |  | **Рекомендуемый**. Квартира.
address | STRING |  | **Рекомендуемый**. Полный адрес в виде строки.

#### Адрес в виде строки
```http request
POST /api/v1/address/get/string
```
Возвращает адрес в виде строки.

**Параметры запроса:**

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный**. Идентификатор объекта.

### Клиент (`client`)

#### Общие
```http request
POST /api/v1/client/[ type | method | count | set | get | list ]
```
[Общие конечные точки](#общие-конечные-точки)

#### Параметры запросов

* Параметры запросов для действия [_установить_](#действие-установить).

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный** для действия _изменить_. Идентификатор объекта.
parent | NUMERIC |  | **Необязательный**. Идентификатор объекта родителя.
type | STRING |  | **Необязательный**. Код типа.
code | STRING |  | **Рекомендуемый**. ИНН - для юридического лица или имя пользователя (login).
userid | NUMERIC |  | **Необязательный**. Идентификатор учётной записи клиента. Если указать 0, то учётная запись будет создана автоматически.
name | JSON |  | **Рекомендуемый**. Наименование компании/Ф.И.О.
phone | JSON |  | **Необязательный**. Справочник телефонов.
email | JSON |  | **Необязательный**. Электронные адреса.
info | JSON |  | **Необязательный**. Дополнительная информация.
description | STRING |  | **Необязательный**. Описание.

**Формат `name`:**

Ключ | Тип | Описание
------------ | ------------ | ------------
name | STRING | **Рекомендуемый**. Полное наименование организации/Ф.И.О одной строкой
short | STRING | **Рекомендуемый**. Краткое наименование организации
first | STRING | **Рекомендуемый**. Имя
last | STRING | **Рекомендуемый**. Фамилия
middle | STRING | **Рекомендуемый**. Отчество

**Формат `phone`:** произвольный.
**Формат `email`:** произвольный.
**Формат `info`:** произвольный.

### Сообщение (`message`)

* Класс подсистемы [Сервер сообщений](https://github.com/ufocomp/process-MessageServer).

#### Общие
```http request
POST /api/v1/message/[ type | method | count | set | get | list ]
```
[Общие конечные точки](#общие-конечные-точки)

#### Параметры запросов

* Параметры запросов для действия [_установить_](#действие-установить).

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный** для действия _изменить_. Идентификатор объекта.
parent | NUMERIC |  | **Необязательный**. Идентификатор объекта родителя.
type | STRING |  | **Обязательный**. Код типа.
agent | NUMERIC |  | **Необязательный**. Агент.
profile | STRING |  | **Обязательный**. Профиль отправителя.
address | STRING |  | **Обязательный**. Адрес получателя.
subject | STRING |  | **Обязательный**. Тема.
content | STRING |  | **Обязательный**. Содержимое.
description | STRING |  | **Необязательный**. Описание.

### Задание (`job`)

* Класс подсистемы [Планировщик заданий](https://github.com/ufocomp/process-TaskScheduler).

#### Общие
```http request
POST /api/v1/job/[ type | method | count | set | get | list ]
```
[Общие конечные точки](#общие-конечные-точки)

#### Параметры запросов

* Параметры запросов для действия [_установить_](#действие-установить).

Имя | Тип | Значение | Описание
------------ | ------------ | ------------ |------------
id | NUMERIC |  | **Обязательный** для действия _изменить_. Идентификатор объекта.
parent | NUMERIC |  | **Необязательный**. Идентификатор объекта родителя.
type | STRING |  | **Обязательный**. Код типа.
scheduler | NUMERIC |  | **Обязательный**. Планировщик.
program | NUMERIC |  | **Обязательный**. Программа.
dateRun | TIMESTAMP |  | **Необязательный**. Дата запуска.
code | STRING |  | **Необязательный**. Код.
label | STRING |  | **Необязательный**. Метка.
description | STRING |  | **Необязательный**. Описание.

## Данные объекта
* Данные объекта хранятся в _класс-таблицах_. Конечный набор данных для каждого объекта формируется путём добавления друг к другу всех полей из всех _класс-таблиц_.

## Класс таблицы

### Объект (object)

Поле | Тип | Описание
------------ | ------------ | ------------
id | NUMERIC | Идентификатор объекта.
parent | NUMERIC | Идентификатор родителя объекта.
entity | NUMERIC | Идентификатор сущности.
entitycode | STRING | Код сущности.
class | NUMERIC | Идентификатор класса.
classcode | STRING | Код класса.
classlabel | STRING | Метка класса.
type | NUMERIC | Идентификатор типа.
typecode | STRING | Код типа.
typename | STRING | Наименование типа.
typedescription | STRING | Описание типа.
label | STRING | Метка.
statetype | NUMERIC | Тип состояния.
statetypecode | STRING | Код типа состояния.
statetypename | STRING | Наименование типа состояния.
state | NUMERIC | Состояние.
statecode | STRING | Код состояния.
statelabel | STRING | Метка состояния.
lastupdate | TIMESTAMP | Дата последнего изменения.
owner | NUMERIC | Идентификатор учётной записи владельца.
ownercode | STRING | Код (логин) учётной записи владельца.
ownername | STRING | Наименование учётной записи владельца.
created | TIMESTAMP | Физическая дата (дата создания).
oper | NUMERIC | Идентификатор учётной записи оператора.
opercode | STRING | Код (логин) учётной записи оператора.
opername | STRING | Наименование учётной записи оператора.
operdate | TIMESTAMP | Логическая дата (дата операции).

### Документ (document)

Поле | Тип | Описание
------------ | ------------ | ------------
area | NUMERIC | Идентификатор зоны видимости объекта.
areacode | STRING | Код зоны видимости объекта.
areaname | STRING | Наименование зоны видимости объекта.
description | STRING | Описание.

### Справочник (reference)

Поле | Тип | Описание
------------ | ------------ | ------------
code | STRING | Код.
name | STRING | Наименование.
description | STRING | Описание.

### Адрес (address)

Поле | Тип | Описание
------------ | ------------ | ------------
code | STRING | Код КЛАДР (ФФ СС РРР ГГГ ППП УУУУ).
index | STRING | Почтовый индекс.
country | STRING | Страна.
region | STRING | Регион.
district | STRING | Район.
city | STRING | Город.
settlement | STRING | Населённый пункт.
street | STRING | Улица.
house | STRING | Дом.
building | STRING | Корпус.
structure | STRING | Строение.
apartment | STRING | Квартира.
address | STRING | Полный адрес.

**Описание `code`:**

|  ФФ   |   СС   |   РРР   |   ГГГ   |    ППП   |    УУУУ   |
| :---: | :----: | :-----: | :-----: | :------: |  :------: |
| Код страны | Код субъекта РФ | Код района | Код города | Код населенного пункта | Код улицы |

### Клиент (client)

Поле | Тип | Описание
------------ | ------------ | ------------
code | STRING | Код клиента.
userId | NUMERIC | Идентификатор учётной записи клиента.
fullname | STRING | Полное наименование компании/Ф.И.О.
shortname | STRING | Краткое наименование компании.
lastname | STRING | Фамилия.
firstname | STRING | Имя.
middlename | STRING | Отчество.
phone | JSON | Справочник телефонов.
email | JSON | Электронные адреса.
info | JSON | Дополнительная информация.
locale | NUMERIC | Идентификатор локали.
localecode | STRING | Код локали.
localename | STRING | Наименование локали.

### Сообщение (message)

Поле | Тип | Описание
------------ | ------------ | ------------
agent | NUMERIC | Идентификатор агента.
code | STRING | Код.
profile | STRING | Профиль отправителя.
address | STRING | Адрес получателя.
subject | STRING | Тема.
content | STRING | Содержимое.

### Устройство (device)

Поле | Тип | Описание
------------ | ------------ | ------------
model | NUMERIC | Идентификатор модели.
client | NUMERIC | Идентификатор клиента.
identity | STRING | Строковый идентификатор.
version | STRING | Версия.
serial | STRING | Серийный номер.
address | STRING | Сетевой адрес.
iccid | STRING | Integrated circuit card identifier (ICCID) — уникальный серийный номер SIM-карты.
imsi | STRING | International Mobile Subscriber Identity (IMSI) — международный идентификатор мобильного абонента (индивидуальный номер абонента).
